<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>jMineWASM</title>
	<meta name="description" content="jMineWASM is a Minecraft clone written in C++ and compiled to WebAssembly.">
	<meta name="author" content="Jack Kimmins">
	<meta name="keywords" content="Minecraft, WebAssembly, C++, jMineWASM">
	<meta property="og:url" content="https://github.com/jackkimmins/jMineWASM">

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: black;
        }

        canvas {
            display: block;
            /* No fixed width/height here; JS will size it */
            cursor: none;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
	<script>
		let pointerLocked = false;
		const canvas = document.getElementById('canvas');
		canvas.width = 1920;
		canvas.height = 1080;

		function resizeCanvas() {
			const aspect = 16 / 9;
			let w = window.innerWidth;
			let h = window.innerHeight;

			if (w / h > aspect) {
				h = window.innerHeight;
				w = h * aspect;
			} else {
				w = window.innerWidth;
				h = w / aspect;
			}

			canvas.style.width = w + 'px';
			canvas.style.height = h + 'px';
		}

		// Initial size + resize handling
		resizeCanvas();
		window.addEventListener('resize', resizeCanvas);

		canvas.addEventListener('contextmenu', function(e) { e.preventDefault(); }, false);
		canvas.addEventListener('click', function() { canvas.requestPointerLock(); }, false);

		document.addEventListener('pointerlockchange', lockChangeAlert, false);
		document.addEventListener('mozpointerlockchange', lockChangeAlert, false);
		document.addEventListener('webkitpointerlockchange', lockChangeAlert, false);

		function lockChangeAlert() {
			pointerLocked = (document.pointerLockElement === canvas ||
				document.mozPointerLockElement === canvas ||
				document.webkitPointerLockElement === canvas);
			canvas.style.cursor = pointerLocked ? 'none' : 'default';
			Module.ccall('setPointerLocked', 'void', ['bool'], [pointerLocked]);
		}

		document.addEventListener('keydown', function(e) {
			if (e.key === 'Escape') {
				document.exitPointerLock();
			} else if (e.key === 'F11') {
				if (document.fullscreenElement) {
					document.exitFullscreen();
				} else {
					document.documentElement.requestFullscreen();
					canvas.requestPointerLock();
				}
			} else {
				canvas.requestPointerLock();
			}
		});

		document.addEventListener('click', function() {
			if (!pointerLocked) {
				canvas.requestPointerLock();
			}
		});

		Module = {
			preRun: [function() {
				const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
				const host = window.location.hostname;
				const isProduction = window.location.protocol === 'https:';
				const port = isProduction ? '' : ':8888';
				ENV.GAME_WS_URL = `${protocol}//${host}${port}/ws`;
			}]
		};
	</script>
    <script src="index.js"></script>
    {{{ SCRIPT }}}
</body>

</html>